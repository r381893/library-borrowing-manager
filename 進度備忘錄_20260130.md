# 圖書館借書管理系統 - 開發進度備忘錄

## 日期：2026-01-30

### ✅ 2026-01-30 第二階段完成事項
- [x] **修復借閱人/日期欄位錯置**：自動偵測並修正 Excel 中的資料。
- [x] **活動記錄持久化**：新增 `activity_log.json` 保存記錄，重啟後不遺失。
- [x] **優化刪除功能**：改用自定義 Modal 取代 `window.confirm`，避免被瀏覽器阻擋。
- [x] **美化介面**：借閱人（ELMO、妹、州家庭等）顯示為彩色標籤 (Badge)。

## ✅ 已完成的功能

### 「今日活動」分頁功能
已新增類似銀行交易明細的活動記錄功能，讓你可以知道今天新增、編輯或刪除了哪些書籍。

#### 後端改動 (server.py)
1. 新增 `ACTIVITY_LOG` 全域變數來儲存活動記錄
2. 新增 `add_activity()` 函數來記錄每次操作
3. 在 `add_book()`、`update_book()`、`delete_book()` API 中加入活動記錄
4. 新增 `/api/activities` GET 端點取得今日活動記錄
5. 新增 `/api/activities` DELETE 端點清除活動記錄
6. **注意**：端口已從 5000 改為 5001（因 macOS AirPlay 佔用 5000）

#### 前端改動 (App.jsx)
1. 新增 `ActivityLog` 組件，包含：
   - 統計卡片（今日總操作、新增、編輯、刪除次數）
   - 時間線風格的活動記錄列表
   - 詳細的變更紀錄（舊值 → 新值）
   - 刷新和清除記錄按鈕
2. 在視圖切換中新增「今日活動」按鈕
3. 新增活動相關狀態變數和 API 呼叫函數
4. **注意**：API URL 已從 5000 改為 5001

#### CSS 改動 (App.css)
新增完整的活動記錄樣式，包含：
- 統計卡片樣式
- 時間線設計
- 變更細節顯示
- 響應式設計

## 🔧 下次啟動方式

1. 啟動後端：
   ```bash
   cd /Volumes/M700/library-borrowing-manager
   python3 server.py
   ```
   服務會在 http://localhost:5001 啟動

2. 啟動前端：
   ```bash
   cd /Volumes/M700/library-borrowing-manager/library-app
   npm run dev
   ```
   服務會在 http://localhost:5173 啟動

## ⚠️ 注意事項

- 活動記錄目前只保存在記憶體中，重啟後端服務會清空
- 記錄只顯示當天的活動
- 如果需要持久化記錄，可以考慮存入檔案或資料庫

## 🔧 資料修正（2026-01-30 10:47）

### 問題
Excel 資料中，部分「已看」分類的書籍，借閱人（如 ELMO、妹）被誤填在「到期日」欄位，導致表格顯示錯誤。

### 解決方案
在 `server.py` 中新增 `is_valid_date()` 函數：
- 自動偵測「到期日」欄位是否為有效日期格式
- 如果不是日期（如借閱人名稱），自動移到「備註」欄位
- 無需手動修改 Excel 資料，程式會自動處理

---

## 📝 待測試項目

- 新增書籍後確認活動記錄顯示
- 編輯書籍後確認變更細節顯示
- 刪除書籍後確認記錄
- 變更分類後確認記錄
